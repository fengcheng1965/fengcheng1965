<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIé›†æˆæµ‹è¯• - è‹é¡ºæ¤ä¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #43A047;
            margin-bottom: 20px;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #333;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .success {
            background: #e8f5e9;
            border: 1px solid #43A047;
            color: #2e7d32;
        }
        .error {
            background: #ffebee;
            border: 1px solid #F44336;
            color: #c62828;
        }
        .info {
            background: #e3f2fd;
            border: 1px solid #1976D2;
            color: #1565c0;
        }
        button {
            background: #43A047;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #388e3c;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #43A047;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #43A047;
        }
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª è‹é¡ºæ¤ä¿ - å‰åç«¯é›†æˆæµ‹è¯•</h1>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalTests">0</div>
                <div class="stat-label">æ€»æµ‹è¯•æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="passedTests">0</div>
                <div class="stat-label">é€šè¿‡</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="failedTests">0</div>
                <div class="stat-label">å¤±è´¥</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="successRate">0%</div>
                <div class="stat-label">æˆåŠŸç‡</div>
            </div>
        </div>

        <div class="test-section">
            <h2 class="test-title">1. åç«¯å¥åº·æ£€æŸ¥</h2>
            <button onclick="testHealthCheck()">æµ‹è¯•å¥åº·æ£€æŸ¥</button>
            <div id="healthResult"></div>
        </div>

        <div class="test-section">
            <h2 class="test-title">2. è·å–äº§å“åˆ—è¡¨</h2>
            <button onclick="testGetProducts()">è·å–æ‰€æœ‰äº§å“</button>
            <button onclick="testGetProductById()">è·å–å•ä¸ªäº§å“</button>
            <div id="productsResult"></div>
        </div>

        <div class="test-section">
            <h2 class="test-title">3. ç”¨æˆ·è®¤è¯æµ‹è¯•</h2>
            <button onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
            <button onclick="testRegister()">æµ‹è¯•æ³¨å†Œ</button>
            <div id="authResult"></div>
        </div>

        <div class="test-section">
            <h2 class="test-title">4. ç•™è¨€åŠŸèƒ½æµ‹è¯•</h2>
            <button onclick="testCreateMessage()">åˆ›å»ºç•™è¨€</button>
            <button onclick="testGetMessages()">è·å–ç•™è¨€åˆ—è¡¨</button>
            <div id="messageResult"></div>
        </div>

        <div class="test-section">
            <h2 class="test-title">5. å®¢æˆ·ç®¡ç†æµ‹è¯•</h2>
            <button onclick="testGetCustomers()">è·å–å®¢æˆ·åˆ—è¡¨</button>
            <button onclick="testCreateCustomer()">åˆ›å»ºå®¢æˆ·</button>
            <div id="customerResult"></div>
        </div>

        <div class="test-section">
            <h2 class="test-title">6. è¿è¡Œæ‰€æœ‰æµ‹è¯•</h2>
            <button onclick="runAllTests()">ğŸš€ è¿è¡Œå…¨éƒ¨æµ‹è¯•</button>
            <div id="allTestsResult"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3000/api';
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0
        };

        function updateStats() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('passedTests').textContent = testStats.passed;
            document.getElementById('failedTests').textContent = testStats.failed;
            const rate = testStats.total > 0 ? ((testStats.passed / testStats.total) * 100).toFixed(1) : 0;
            document.getElementById('successRate').textContent = rate + '%';
        }

        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="test-result ${type}">${message}</div>`;
        }

        async function testHealthCheck() {
            testStats.total++;
            showResult('healthResult', 'æ­£åœ¨æµ‹è¯•...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                
                if (data.success && data.status === 'healthy') {
                    testStats.passed++;
                    showResult('healthResult', `âœ… å¥åº·æ£€æŸ¥é€šè¿‡\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    testStats.failed++;
                    showResult('healthResult', `âŒ å¥åº·æ£€æŸ¥å¤±è´¥\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                showResult('healthResult', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        async function testGetProducts() {
            testStats.total++;
            showResult('productsResult', 'æ­£åœ¨è·å–äº§å“åˆ—è¡¨...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/products`);
                const data = await response.json();
                
                if (data.success && Array.isArray(data.data)) {
                    testStats.passed++;
                    showResult('productsResult', `âœ… æˆåŠŸè·å– ${data.data.length} ä¸ªäº§å“\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    testStats.failed++;
                    showResult('productsResult', `âŒ è·å–äº§å“å¤±è´¥\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                showResult('productsResult', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        async function testGetProductById() {
            testStats.total++;
            showResult('productsResult', 'æ­£åœ¨è·å–äº§å“è¯¦æƒ…...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/products/1`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    testStats.passed++;
                    showResult('productsResult', `âœ… æˆåŠŸè·å–äº§å“è¯¦æƒ…\näº§å“åç§°: ${data.data.name}\nä»·æ ¼: Â¥${data.data.price}\n${JSON.stringify(data.data, null, 2)}`, 'success');
                } else {
                    testStats.failed++;
                    showResult('productsResult', `âŒ è·å–äº§å“è¯¦æƒ…å¤±è´¥\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                showResult('productsResult', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        async function testLogin() {
            testStats.total++;
            showResult('authResult', 'æ­£åœ¨æµ‹è¯•ç™»å½•...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });
                const data = await response.json();
                
                if (data.success && data.data.token) {
                    testStats.passed++;
                    showResult('authResult', `âœ… ç™»å½•æˆåŠŸ\nç”¨æˆ·: ${data.data.user.username}\nè§’è‰²: ${data.data.user.role}\nToken: ${data.data.token.substring(0, 20)}...`, 'success');
                } else {
                    testStats.failed++;
                    showResult('authResult', `âŒ ç™»å½•å¤±è´¥\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                showResult('authResult', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        async function testRegister() {
            testStats.total++;
            showResult('authResult', 'æ­£åœ¨æµ‹è¯•æ³¨å†Œ...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: `testuser_${Date.now()}`,
                        password: 'test123',
                        email: `test${Date.now()}@example.com`,
                        role: 'staff'
                    })
                });
                const data = await response.json();
                
                if (data.success) {
                    testStats.passed++;
                    showResult('authResult', `âœ… æ³¨å†ŒæˆåŠŸ\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    testStats.failed++;
                    showResult('authResult', `âŒ æ³¨å†Œå¤±è´¥\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                showResult('authResult', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        async function testCreateMessage() {
            testStats.total++;
            showResult('messageResult', 'æ­£åœ¨åˆ›å»ºç•™è¨€...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/messages`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: 'æµ‹è¯•ç”¨æˆ·',
                        email: 'test@example.com',
                        phone: '13800138000',
                        subject: 'æµ‹è¯•ç•™è¨€',
                        content: 'è¿™æ˜¯ä¸€æ¡æµ‹è¯•ç•™è¨€'
                    })
                });
                const data = await response.json();
                
                if (data.success) {
                    testStats.passed++;
                    showResult('messageResult', `âœ… ç•™è¨€åˆ›å»ºæˆåŠŸ\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    testStats.failed++;
                    showResult('messageResult', `âŒ ç•™è¨€åˆ›å»ºå¤±è´¥\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                showResult('messageResult', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        async function testGetMessages() {
            testStats.total++;
            showResult('messageResult', 'æ­£åœ¨è·å–ç•™è¨€åˆ—è¡¨...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/messages`);
                const data = await response.json();
                
                if (data.success && Array.isArray(data.data)) {
                    testStats.passed++;
                    showResult('messageResult', `âœ… æˆåŠŸè·å– ${data.data.length} æ¡ç•™è¨€\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    testStats.failed++;
                    showResult('messageResult', `âŒ è·å–ç•™è¨€å¤±è´¥\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                showResult('messageResult', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        async function testGetCustomers() {
            testStats.total++;
            showResult('customerResult', 'æ­£åœ¨è·å–å®¢æˆ·åˆ—è¡¨...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/customers`);
                const data = await response.json();
                
                if (data.success && Array.isArray(data.data)) {
                    testStats.passed++;
                    showResult('customerResult', `âœ… æˆåŠŸè·å– ${data.data.length} ä¸ªå®¢æˆ·\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    testStats.failed++;
                    showResult('customerResult', `âŒ è·å–å®¢æˆ·å¤±è´¥\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                showResult('customerResult', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        async function testCreateCustomer() {
            testStats.total++;
            showResult('customerResult', 'æ­£åœ¨åˆ›å»ºå®¢æˆ·...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/customers`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: 'æµ‹è¯•å®¢æˆ·',
                        email: `customer${Date.now()}@example.com`,
                        phone: '13800138000',
                        address: 'æµ‹è¯•åœ°å€'
                    })
                });
                const data = await response.json();
                
                if (data.success) {
                    testStats.passed++;
                    showResult('customerResult', `âœ… å®¢æˆ·åˆ›å»ºæˆåŠŸ\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    testStats.failed++;
                    showResult('customerResult', `âŒ å®¢æˆ·åˆ›å»ºå¤±è´¥\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                showResult('customerResult', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        async function runAllTests() {
            testStats = { total: 0, passed: 0, failed: 0 };
            updateStats();
            
            showResult('allTestsResult', 'ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...\n\n', 'info');
            
            await testHealthCheck();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testGetProducts();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testGetProductById();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testLogin();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testCreateMessage();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testGetMessages();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testGetCustomers();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            const rate = ((testStats.passed / testStats.total) * 100).toFixed(1);
            const summary = `
ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼

æµ‹è¯•ç»Ÿè®¡:
- æ€»æµ‹è¯•æ•°: ${testStats.total}
- é€šè¿‡: ${testStats.passed}
- å¤±è´¥: ${testStats.failed}
- æˆåŠŸç‡: ${rate}%

${rate >= 80 ? 'âœ… é›†æˆæµ‹è¯•é€šè¿‡ï¼' : 'âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥'}
            `;
            
            showResult('allTestsResult', summary, rate >= 80 ? 'success' : 'error');
        }
    </script>
</body>
</html>
